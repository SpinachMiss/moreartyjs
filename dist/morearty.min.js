(function(e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e()}else if(typeof define==="function"&&define.amd){define([],e)}else{var t;if(typeof window!=="undefined"){t=window}else if(typeof global!=="undefined"){t=global}else if(typeof self!=="undefined"){t=self}else{t=this}t.Morearty=e()}})(function(){var e,t,n;return function e(t,n,r){function i(s,u){if(!n[s]){if(!t[s]){var o=typeof require=="function"&&require;if(!u&&o)return o(s,!0);if(a)return a(s,!0);var l=new Error("Cannot find module '"+s+"'");throw l.code="MODULE_NOT_FOUND",l}var f=n[s]={exports:{}};t[s][0].call(f.exports,function(e){var n=t[s][1][e];return i(n?n:e)},f,f.exports,e,t,n,r)}return n[s].exports}var a=typeof require=="function"&&require;for(var s=0;s<r.length;s++)i(r[s]);return i}({1:[function(e,t,n){(function(n){var r=typeof window!=="undefined"?window["React"]:typeof n!=="undefined"?n["React"]:null;var i=e("./src/DOM");t.exports=e("./src/Morearty")(r,i)}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./src/DOM":4,"./src/Morearty":6}],2:[function(e,t,n){(function(n){var r=typeof window!=="undefined"?window["Immutable"]:typeof n!=="undefined"?n["Immutable"]:null;var i=e("./Util");var a=e("./ChangesDescriptor");var s={};var u,o;u=function(e){return e._sharedInternals.backingValue};o=function(e,t){e._sharedInternals.backingValue=t};var l,f,c,d;l=[];f=".";c=function(e){return e?e.split(f):[]};d=function(e,t){return e&&t.length>0?e.getIn(t):e};var h,v;h=function(e){return typeof e==="string"?c(e):i.undefinedOrNull(e)?[]:e};v=function(e){switch(typeof e){case"string":return e;case"number":return e.toString();default:return i.undefinedOrNull(e)?"":e.join(f)}};var g,p,b,m,_;g=function(e,t,n){return e.updateIn(t,s,function(e){return e===s?n():n(e)})};p=function(e,t,n){var r=u(e);var a=i.joinPaths(e._path,t);var s=g(r,a,n);o(e,s);if(r.hasIn(a)){return a}else{return a.slice(0,a.length-1)}};b=function(e,t){var n=i.joinPaths(e._path,t);var a=u(e);var s=n.length;switch(s){case 0:throw new Error("Cannot delete root value");default:var l=n.slice(0,s-1);if(a.has(l[0])||s===1){var f=a.updateIn(l,function(e){var t=n[s-1];if(r.List.isList(e)){return e.splice(t,1)}else{return e&&e.remove(t)}});o(e,f)}return l}};m=function(e,t,n){if(i.undefinedOrNull(n)){return t}else{if(r.Iterable.isIterable(n)&&r.Iterable.isIterable(n)){return e?t.mergeDeep(n):n.mergeDeep(t)}else{return e?n:t}}};_=function(e){return r.Iterable.isIterable(e)?e.clear():null};var y=function(e,t,n,r,i){return{currentBackingValue:e,currentBackingMeta:n,previousBackingValue:t,previousBackingMeta:r,metaMetaChanged:i||false}};var w=function(){return Math.random().toString(36).substr(2,9)};var M,I,C,E,B,S;M=function(e,t,n,r,s){var u=s.currentBackingValue;var o=s.previousBackingValue;var l=s.currentBackingMeta;var f=s.previousBackingMeta;i.getPropertyValues(t).forEach(function(e){if(!e.disabled){var t=h(n);var i=u!==o&&u.getIn(t)!==o.getIn(t);var c=s.metaMetaChanged||f&&l!==f&&l.getIn(t)!==f.getIn(t);if(i||c){e.cb(new a(r,t,i,c,s))}}})};I=function(e,t,n){var r=e._sharedInternals.listeners;var i=r[""];if(i){M(e,i,l,t,n)}};C=function(e,t){return e.indexOf(t)===0};E=function(e,t){return t===""||e===t||C(t,e+f)||C(e,t+f)};B=function(e,t,n){var r=e._sharedInternals.listeners;Object.keys(r).filter(i.identity).forEach(function(i){if(E(i,v(t))){M(e,r[i],i,t,n)}})};S=function(e,t,n){I(e,t,n);B(e,t,n)};var P,R;P=function(e,t){e._sharedInternals.metaBindingListenerId=t.addListener(function(n){var r=n.getPath();var i=r.slice(0,r.length-1);var a=u(e);var s=!n.isValueChanged();var o=s?u(t):n.getPreviousValue();S(e,i,y(a,a,u(t),o,s))})};R=function(e,t){var n=t.removeListener(e._sharedInternals.metaBindingListenerId);e._sharedInternals.metaBinding=null;e._sharedInternals.metaBindingListenerId=null;return n};var k,V;k=function(e,t){return i.find(i.getPropertyValues(e._sharedInternals.listeners),function(e){return!!e[t]})};V=function(e,t,n){var r=k(e,t);if(r){r[t].disabled=n}};var O,A;O=function(e,t,n){var r=u(e);var i=p(e,h(t),n);var a=u(e.meta());S(e,i,y(u(e),r,a,a))};A=function(e,t){var n=u(e);var r=b(e,h(t));var i=u(e.meta());S(e,r,y(u(e),n,i,i))};var L=function(e,t){this._path=e||l;this._sharedInternals=t||{};if(!this._sharedInternals.listeners){this._sharedInternals.listeners={}}if(!this._sharedInternals.cache){this._sharedInternals.cache={}}};L.init=function(e,t){var n=new L(l,{backingValue:e||r.Map(),metaBinding:t});if(t){P(n,t)}return n};L.asArrayPath=function(e){return h(e)};L.asStringPath=function(e){return v(e)};L.META_NODE=i.META_NODE;var U={getPath:function(){return this._path},withBackingValue:function(e){var t={};i.assign(t,this._sharedInternals);t.backingValue=e;return new L(this._path,t)},isChanged:function(e,t){var n=this.get();var r=e?e.getIn(this._path):undefined;return t?!t(n,r):!(n===r||i.undefinedOrNull(n)&&i.undefinedOrNull(r))},isRelative:function(e){return this._sharedInternals===e._sharedInternals&&this._sharedInternals.backingValue===e._sharedInternals.backingValue},meta:function(e){if(!this._sharedInternals.metaBinding){var t=L.init(r.Map());P(this,t);this._sharedInternals.metaBinding=t}var n=e?i.joinPaths([i.META_NODE],h(e)):[i.META_NODE];var a=this.getPath();var s=a.length>0?i.joinPaths(a,n):n;return this._sharedInternals.metaBinding.sub(s)},unlinkMeta:function(){var e=this._sharedInternals.metaBinding;return e?R(this,e):false},get:function(e){return d(u(this),i.joinPaths(this._path,h(e)))},toJS:function(e){var t=this.sub(e).get();return r.Iterable.isIterable(t)?t.toJS():t},sub:function(e){var t=h(e);var n=i.joinPaths(this._path,t);if(n.length>0){var r=v(n);var a=this._sharedInternals.cache[r];if(a){return a}else{var s=new L(n,this._sharedInternals);this._sharedInternals.cache[r]=s;return s}}else{return this}},update:function(e,t){var n=i.resolveArgs(arguments,"?subpath","f");O(this,n.subpath,n.f);return this},set:function(e,t){var n=i.resolveArgs(arguments,"?subpath","newValue");O(this,n.subpath,i.constantly(n.newValue));return this},remove:function(e){A(this,e);return this},merge:function(e,t,n){var r=i.resolveArgs(arguments,function(e){return i.canRepresentSubpath(e)?"subpath":null},"?preserve","newValue");O(this,r.subpath,m.bind(null,r.preserve,r.newValue));return this},clear:function(e){var t=h(e);if(!i.undefinedOrNull(this.get(t))){O(this,t,_)}return this},addListener:function(e,t){var n=i.resolveArgs(arguments,function(e){return i.canRepresentSubpath(e)?"subpath":null},"cb");var r=w();var a=v(i.joinPaths(this._path,h(n.subpath||"")));var s=this._sharedInternals.listeners[a];var u={cb:n.cb,disabled:false};if(s){s[r]=u}else{var o={};o[r]=u;this._sharedInternals.listeners[a]=o}return r},addOnceListener:function(e,t){var n=i.resolveArgs(arguments,function(e){return i.canRepresentSubpath(e)?"subpath":null},"cb");var r=this;var a=r.addListener(n.subpath,function(){r.removeListener(a);n.cb()});return a},enableListener:function(e){V(this,e,false);return this},disableListener:function(e){V(this,e,true);return this},withDisabledListener:function(e,t){var n=k(this,e);if(n){var r=n[e];r.disabled=true;i.afterComplete(t,function(){r.disabled=false})}else{t()}return this},removeListener:function(e){var t=k(this,e);return t?delete t[e]:false},atomically:function(e){return new x(this,e)}};U["delete"]=U.remove;L.prototype=U;var x=function(e,t){this._binding=e;this._queuedUpdates=[];this._finishedUpdates=[];this._committed=false;this._cancelled=false;this._hasChanges=false;this._hasMetaChanges=false;if(t){var n=this;t.then(i.identity,function(){if(!n.isCancelled()){n.cancel()}})}};x.prototype=function(){var e=Object.freeze({UPDATE:"update",DELETE:"delete"});var t,n;t=function(e,t){if(!e._hasChanges){e._hasChanges=t.isRelative(e._binding)}if(!e._hasMetaChanges){e._hasMetaChanges=!t.isRelative(e._binding)}};n=function(e){return e._hasChanges||e._hasMetaChanges};var r,a,s,o,l;r=function(n,r,i,a){t(n,r);n._queuedUpdates.push({binding:r,update:i,subpath:a,type:e.UPDATE})};a=function(n,r,i){t(n,r);n._queuedUpdates.push({binding:r,subpath:i,type:e.DELETE})};s=function(e,t){var n=e.length,r=t.length;return n===r&&(n===1||e[n-2]===t[n-2])};o=function(e){if(e.length<2){return e}else{var t=e.sort();var n=t[0],r=v(n);var i=[n];for(var a=1;a<t.length;a++){var u=t[a],o=v(u);if(!C(o,r)){if(s(u,n)){var l=u.slice(0,u.length-1);i.pop();i.push(l);n=l;r=v(l)}else{i.push(u);n=u;r=o}}}return i}};l=function(t){var n=t._queuedUpdates.map(function(t){var n=u(t.binding);var r=t.type===e.UPDATE?p(t.binding,t.subpath,t.update):b(t.binding,t.subpath);return{affectedPath:r,binding:t.binding,previousBackingValue:n}});t._committed=true;t._queuedUpdates=null;return n};var f=function(e){var t=e._finishedUpdates;if(t.length>0){var n=e._binding.atomically();for(var r=t.length;r-- >0;){var i=t[r];var a=i.binding,s=i.affectedPath;var u=a.getPath().length===s.length?s:s.slice(a.getPath().length);n.set(a,u,i.previousBackingValue.getIn(s))}n.commit()}e._finishedUpdates=null};var c=function(e){if(e.isCommitted()){f(e)}e._cancelled=true};var d={update:function(e,t,n){var a=i.resolveArgs(arguments,function(e){return e instanceof L?"binding":null},"?subpath","f");r(this,a.binding||this._binding,a.f,h(a.subpath));return this},set:function(e,t,n){var r=i.resolveArgs(arguments,function(e){return e instanceof L?"binding":null},"?subpath","newValue");return this.update(r.binding,r.subpath,i.constantly(r.newValue))},remove:function(e,t){var n=i.resolveArgs(arguments,function(e){return e instanceof L?"binding":null},"?subpath");a(this,n.binding||this._binding,h(n.subpath));return this},merge:function(e,t,n,r){var a=i.resolveArgs(arguments,function(e){return e instanceof L?"binding":null},function(e){return i.canRepresentSubpath(e)?"subpath":null},function(e){return typeof e==="boolean"?"preserve":null},"newValue");return this.update(a.binding,a.subpath,m.bind(null,a.preserve,a.newValue))},clear:function(e,t){var n=i.resolveArgs(arguments,function(e){return e instanceof L?"binding":null},"?subpath");r(this,n.binding||this._binding,_,h(n.subpath));return this},commit:function(e){if(!this.isCommitted()){if(!this.isCancelled()&&n(this)){var t=e||{};var r=this._binding;var i=r.meta();var a=null,s=null;if(t.notify!==false){a=u(r);s=u(i)}this._finishedUpdates=l(this);var f=this._finishedUpdates.map(function(e){return e.affectedPath});if(t.notify!==false){var c=o(f);var d=y(u(r),a,u(i),s);I(r,c[0],d);c.forEach(function(e){B(r,e,d)})}}return this}else{throw new Error("Morearty: transaction already committed")}},cancel:function(){if(!this.isCancelled()){c(this)}else{throw new Error("Morearty: transaction already cancelled")}},isCommitted:function(){return this._committed},isCancelled:function(){return this._cancelled}};d["delete"]=d.remove;return d}();t.exports=L}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./ChangesDescriptor":3,"./Util":7}],3:[function(e,t,n){var r=e("./Util");var i=function(e,t,n,i,a){this._path=e;this._listenerPath=t;this._metaPath=r.joinPaths(t,[r.META_NODE]);this._valueChanged=n;this._metaChanged=i;this._currentBackingValue=a.currentBackingValue;this._previousBackingValue=a.previousBackingValue;this._currentBackingMeta=a.currentBackingMeta;this._previousBackingMeta=a.previousBackingMeta};i.prototype={getPath:function(){var e=this._listenerPath.length;return e===this._path.length?[]:this._path.slice(e)},isValueChanged:function(){return this._valueChanged},isMetaChanged:function(){return this._metaChanged},getCurrentValue:function(){return this._currentBackingValue.getIn(this._listenerPath)},getPreviousValue:function(){return this._previousBackingValue.getIn(this._listenerPath)},getCurrentMeta:function(){return this._currentBackingMeta?this._currentBackingMeta.getIn(this._metaPath):null},getPreviousMeta:function(){return this._previousBackingMeta?this._previousBackingMeta.getIn(this._metaPath):null},getPreviousBackingValue:function(){return this._previousBackingValue},getPreviousBackingMeta:function(){return this._previousBackingMeta||null}};t.exports=i},{"./Util":7}],4:[function(e,t,n){(function(n){var r=e("./Util");var i=typeof window!=="undefined"?window["React"]:typeof n!=="undefined"?n["React"]:null;var a=function(){if(i)return i.DOM;else{throw new Error("Morearty: global variable React not found")}}();var s=function(e,t){return i.createClass({displayName:t,getInitialState:function(){return{value:this.props.value}},onChange:function(e){var t=this.props.onChange;if(t){t(e);this.setState({value:e.target.value})}},componentWillReceiveProps:function(e){this.setState({value:e.value})},render:function(){var t=r.assign({},this.props,{value:this.state.value,onChange:this.onChange,children:this.props.children});return e(t)}})};var u={input:s(a.input,"input"),textarea:s(a.textarea,"textarea"),option:s(a.option,"option")};t.exports=u}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./Util":7}],5:[function(e,t,n){(function(n){var r=typeof window!=="undefined"?window["Immutable"]:typeof n!=="undefined"?n["Immutable"]:null;var i=e("./Binding");var a,s,u,o,l,f,c;a=function(e){return e.meta("history")};s=function(e){e.set(r.fromJS({listenerId:null,undo:[],redo:[]}))};u=function(e){var t=e.get("listenerId");e.withDisabledListener(t,function(){e.atomically().set("undo",r.List.of()).set("redo",r.List.of()).commit()})};o=function(e,t){var n=a(e);var r=n.get("listenerId");e.removeListener(r);n.atomically().set(null).commit({notify:t})};l=function(e,t){var n=e.addListener([],function(n){if(n.isValueChanged()){t.atomically().update(function(t){var a=n.getPath();var s=n.getPreviousValue(),u=e.get();return t.update("undo",function(e){var t=i.asArrayPath(a);return e&&e.unshift(r.Map({newValue:t.length?u.getIn(t):u,oldValue:t.length?s&&s.getIn(t):s,path:a}))}).set("redo",r.List.of())}).commit({notify:false})}});t.atomically().set("listenerId",n).commit({notify:false})};f=function(e,t,n,r){r.withDisabledListener(n,function(){r.set(e,t)})};c=function(e,t,n,r,i){var a=t.get();if(!a.isEmpty()){var s=a.get(0);t.atomically().remove(0).update(n,function(e){return e.unshift(s)}).commit({notify:false});f(s.get("path"),s.get(i),r,e);return true}else{return false}};var d={init:function(e){var t=a(e);s(t);l(e,t)},clear:function(e){var t=a(e);u(t)},destroy:function(e,t){var n=t||{};o(e,n.notify)},hasUndo:function(e){var t=a(e);var n=t.get("undo");return!!n&&!n.isEmpty()},hasRedo:function(e){var t=a(e);var n=t.get("redo");return!!n&&!n.isEmpty()},undo:function(e){var t=a(e);var n=t.get("listenerId");var r=t.sub("undo");var i=t.sub("redo");return c(e,r,i,n,"oldValue")},redo:function(e){var t=a(e);var n=t.get("listenerId");var r=t.sub("undo");var i=t.sub("redo");return c(e,i,r,n,"newValue")}};t.exports=d}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./Binding":2}],6:[function(e,t,n){(function(n){var r=typeof window!=="undefined"?window["Immutable"]:typeof n!=="undefined"?n["Immutable"]:null;var i=e("./Util");var a=e("./Binding");var s=e("./History");var u=e("./util/Callback");var o=Object.freeze({OVERWRITE:"overwrite",OVERWRITE_EMPTY:"overwrite-empty",MERGE_PRESERVE:"merge-preserve",MERGE_REPLACE:"merge-replace"});var l,f,c,d;l=function(e,t){var n=e.binding;return t?n[t]:n};d=function(e){return typeof e.get==="function"};f=function(e,t,n,r){return e._stateChanged&&n!==t.get()||e._metaChanged&&e._metaBinding.sub(t.getPath()).isChanged(r)};c=function(e,t,n,r,a){if(!t)return false;else{var s=e.getMoreartyContext();if(d(t)){return t!==n||f(s,t,r,a)}else{if(s._stateChanged||s._metaChanged){var u=Object.keys(t);return!!i.find(u,function(e){var i=t[e];return i&&(i!==n[e]||f(s,i,r[e],a))})}else{return false}}}};var h,v,g;h=function(e,t,n){return t[e]!==n[e]};v=function(e){var t=0;for(var n in e)++t;return t};g=function(e,t){var n=t||{},r=e.props||{};if(v(n)!==v(r)){return true}else{for(var i in n){if(i!=="binding"&&h(i,n,r))return true}return false}};var p=function(e,t,n){var a=n.atomically();if(typeof e==="function"){a=a.update(function(n){return e(n,t)})}else{switch(e){case o.OVERWRITE:a=a.set(t);break;case o.OVERWRITE_EMPTY:a=a.update(function(e){var n=i.undefinedOrNull(e)||r.Iterable.isIterable(e)&&e.isEmpty();return n?t:e});break;case o.MERGE_PRESERVE:a=a.merge(true,t);break;case o.MERGE_REPLACE:a=a.merge(false,t);break;default:throw new Error("Invalid merge strategy: "+e)}}a.commit({notify:false})};var b=function(e){var t=typeof window!=="undefined"&&window.requestAnimationFrame;var n=function(e){setTimeout(e,1e3/60)};if(e._options.requestAnimationFrameEnabled){if(t)return t;else{console.warn("Morearty: requestAnimationFrame is not available, will render using setTimeout");return n}}else{return n}};var m,_,y,w;m=function(e,t,n){if(typeof e[t]==="function"){var i=e[t]();if(i){var a=l(e.props);var s=typeof e.getMergeStrategy==="function"?e.getMergeStrategy():o.MERGE_PRESERVE;var u=r.Iterable.isIterable(i);if(d(a)){var f=u?i:i["default"];p(s,f,n(a))}else{var c=Object.keys(a);var h=c.length===1?c[0]:"default";var v=typeof s==="string"?s:s[h];if(u){p(v,i,n(a[h]))}else{c.forEach(function(e){if(i[e]){p(v,i[e],n(a[e]))}})}}}}};_=function(e){m(e,"getDefaultState",i.identity)};y=function(e){m(e,"getDefaultMetaState",function(e){return e.meta()})};w=function(e){var t=e.props.binding;if(t){var n=e.getMoreartyContext();e._previousMetaState=n&&n.getCurrentMeta();if(d(t)){e._previousState=t.get()}else{e._previousState={};Object.keys(e.props.binding).forEach(function(t){e._previousState[t]=e.props.binding[t]&&e.props.binding[t].get()})}}else{e._previousState=null;e._previousMetaState=null}};var M,I,C,E;M=function(e,t){e._componentQueue[t.componentQueueId]=t};I=function(e,t){delete e._componentQueue[t.componentQueueId]};C=function(e){return e?++e._lastComponentQueueId:0};E=function(e,t){if(!e._observedListenerRemovers){e._observedListenerRemovers=[]}var n=t.addListener(function(){M(e.getMoreartyContext(),e)});e._observedListenerRemovers.push(function(){t.removeListener(n)})};var B={error:function(e,t){console.error(e);console.error("Error details: %s",t.message,t.stack)}};t.exports=function(e,t){var n=function(e,t,n){this._initialMetaState=t.get();this._previousMetaState=null;this._metaBinding=t;this._metaChanged=false;this._initialState=e.get();this._previousState=null;this._stateBinding=e;this._stateChanged=false;this._options=n;this._renderQueued=false;this._fullUpdateQueued=false;this._fullUpdateInProgress=false;this._componentQueue=[];this._lastComponentQueueId=0};var f={getBinding:function(){return this._stateBinding},getMetaBinding:function(){return this._metaBinding},getCurrentState:function(){return this.getBinding().get()},getPreviousState:function(){return this._previousState},getCurrentMeta:function(){var e=this.getMetaBinding();return e?e.get():undefined},getPreviousMeta:function(){return this._previousMetaState},copy:function(e){return new n(this._stateBinding.sub(e),this._metaBinding.sub(e),this._options)},resetState:function(e,t){var n=i.resolveArgs(arguments,function(e){return i.canRepresentSubpath(e)?"subpath":null},"?options");var r=n.subpath?a.asArrayPath(n.subpath):[];var s=this.getBinding().atomically();s.set(r,this._initialState.getIn(r));var u=n.options||{};if(u.resetMeta!==false){s.set(this.getMetaBinding(),r,this._initialMetaState.getIn(r))}s.commit({notify:u.notify})},replaceState:function(e,t,n){var a=i.resolveArgs(arguments,"newState",function(e){return r.Map.isMap(e)?"newMetaState":null},"?options");var s=a.options||{};var u=this.getBinding().atomically();u.set(e);if(a.newMetaState)u.set(this.getMetaBinding(),a.newMetaState);u.commit({notify:s.notify})},isChanged:function(e,t,n){var a=i.resolveArgs(arguments,"binding",function(e){return i.canRepresentSubpath(e)?"subpath":null},"?compare");return a.binding.sub(a.subpath).isChanged(this._previousState,a.compare||r.is)},init:function(e){var t=this;var n=false;var r=[];var a=function(){var e,n;if(r.length===1){var a=r[0];e=a.stateChanged;n=a.metaChanged;if(e)t._previousState=a.previousState;if(n)t._previousMetaState=a.previousMetaState}else{var s=i.find(r,function(e){return e.stateChanged});var u=i.find(r,function(e){return e.metaChanged});e=!!s;n=!!u;if(e)t._previousState=s.previousState;if(n)t._previousMetaState=u.previousMetaState}t._stateChanged=e;t._metaChanged=n;r=[]};var s=function(e,t){if(e.isMounted()){e.forceUpdate(t)}};var u=function(e,n){if(t._options.logger){try{t._options.logger.error(e,n)}catch(t){B.error(e,n)}}};var o=function(e){try{e()}catch(e){if(t._options.stopOnRenderError){n=true}u("Morearty: render error. "+(n?"Will exit on next render attempt.":"Continuing."),e)}};var l=function(){a();t._renderQueued=false;o(function(){if(t._fullUpdateQueued){t._fullUpdateInProgress=true;s(e,function(){t._fullUpdateQueued=false;t._fullUpdateInProgress=false})}else{s(e);t._componentQueue.forEach(function(e){s(e);w(e)});t._componentQueue=[]}})};if(!t._options.renderOnce){var f=b(t);var c=t._stateBinding.addListener(function(e){if(n){t._stateBinding.removeListener(c)}else{var i=e.isValueChanged(),a=e.isMetaChanged();if(i||a){r.push({stateChanged:i,metaChanged:a,previousState:(i||null)&&e.getPreviousBackingValue(),previousMetaState:(a||null)&&e.getPreviousBackingMeta()});if(!t._renderQueued){t._renderQueued=true;f(l)}}}})}o(e.forceUpdate.bind(e))},queueFullUpdate:function(){this._fullUpdateQueued=true},bootstrap:function(t,n){var r=this;var a=n||{};a.morearty=r;return e.createClass({displayName:"Bootstrap",childContextTypes:{morearty:e.PropTypes.object.isRequired},getChildContext:function(){return a},componentWillMount:function(){r.init(this)},render:function(){var n=i.assign({},{binding:r.getBinding()},this.props);return e.createFactory(t)(n)}})}};n.prototype=f;return{Binding:a,History:s,Util:i,Callback:u,DOM:t,MergeStrategy:o,Mixin:{contextTypes:{morearty:e.PropTypes.object.isRequired},getMoreartyContext:function(){return this.context.morearty},getBinding:function(e){return l(this.props,e)},getDefaultBinding:function(){var e=l(this.props);if(e){if(d(e)){return e}else if(typeof e==="object"){var t=Object.keys(e);return t.length===1?e[t[0]]:e["default"]}}else{return this.observedBindings&&this.observedBindings[0]}},getPreviousState:function(e){var t=this.getMoreartyContext();return l(this.props,e).withBackingValue(t._previousState).get()},observeBinding:function(e,t){if(!this.observedBindings){this.observedBindings=[]}var n=e.getPath();if(!i.find(this.observedBindings,function(e){return e.getPath()===n})){this.observedBindings.push(e);E(this,e)}return t?t(e.get()):undefined},componentWillMount:function(){this.componentQueueId=C(this.getMoreartyContext());w(this);_(this);y(this);if(this.observedBindings){this.observedBindings.forEach(E.bind(null,this))}},shouldComponentUpdate:function(e,t,n){var r=this;var i=r.getMoreartyContext();var a=r._previousState;var s=r._previousMetaState;w(r);var u=function(){return i._fullUpdateInProgress||c(r,l(e),l(r.props),a,s)||g(r,e)};var o=r.shouldComponentUpdateOverride;return o?o(u,e,t,n):u()},addBindingListener:function(e,t,n){var r=i.resolveArgs(arguments,function(e){return d(a)?"binding":null},function(e){return i.canRepresentSubpath(e)?"subpath":null},"cb");if(!this._bindingListenerRemovers){this._bindingListenerRemovers=[]}var s=r.binding||this.getDefaultBinding();if(!s){return console.warn("Morearty: cannot attach binding listener to a component without default binding")}var u=s.addListener(r.subpath,r.cb);this._bindingListenerRemovers.push(function(){s.removeListener(u)});return u},componentDidUpdate:function(){I(this.getMoreartyContext(),this)},componentWillUnmount:function(){if(this._observedListenerRemovers){this._observedListenerRemovers.forEach(function(e){e()});this._observedListenerRemovers=[]}if(this._bindingListenerRemovers){this._bindingListenerRemovers.forEach(function(e){e()});this._bindingListenerRemovers=[]}}},createContext:function(e){var t,i,s;if(arguments.length<=1){var u=e||{};t=u.initialState;i=u.initialMetaState;s=u.options}else{console.warn("Passing multiple arguments to createContext is deprecated. Use single object form instead.");t=arguments[0];i=arguments[1];s=arguments[2]}var o=function(e){return r.Iterable.isIterable(e)?e:r.fromJS(e)};var l=o(t||{});var f=o(i||{});var c=a.init(f);var d=a.init(l,c);var h=s||{};return new n(d,c,{requestAnimationFrameEnabled:h.requestAnimationFrameEnabled!==false,renderOnce:h.renderOnce||false,stopOnRenderError:h.stopOnRenderError||false,logger:h.logger||B})}}}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./Binding":2,"./History":5,"./Util":7,"./util/Callback":8}],7:[function(e,t,n){var r,i,a;r=function(e){return typeof e==="string"&&e.charAt(0)!=="?"};i=function(e,t){var n=t(e[0]);for(var r=1;r<e.length;r++){if(t(e[r])!==n)return r}return null};a=function(e,t){return e.slice(t).reverse().concat(e.slice(0,t))};t.exports={identity:function(e){return e},not:function(e){return!e},constantly:function(e){return function(){return e}},async:function(e){setTimeout(e,0)},afterComplete:function(e,t){var n=e();if(n&&typeof n.always==="function"){n.always(t)}else{t()}},undefinedOrNull:function(e){return e===undefined||e===null},getPropertyValues:function(e){return Object.keys(e).map(function(t){return e[t]})},find:function(e,t){for(var n=0;n<e.length;n++){var r=e[n];if(t(r,n,e)){return r}}return null},resolveArgs:function(e,t){var n={};if(arguments.length>1){var s=Array.isArray(t)?t:Array.prototype.slice.call(arguments,1);var u,o;var l;if(r(s[0])||!(l=i(s,r))){u=s;o=e}else{var f=Array.isArray(e)?e:Array.prototype.slice.call(e);u=a(s,l);o=a(f,f.length-(s.length-l))}for(var c=0,d=0;c<u.length&&d<o.length;c++){var h=u[c],v=o[d];if(r(h)){n[h]=v;d++}else{var g=typeof h==="function"?h(v):h.charAt(0)!=="?"?h:h.substring(1);if(g||v===undefined){n[g]=v;d++}}}}return n},canRepresentSubpath:function(e){var t=typeof e;return t==="string"||t==="number"||Array.isArray(e)},META_NODE:"__meta__",joinPaths:function(e,t){return e.length===0?t:t.length===0?e:e.concat(t)},assign:function(e,t){if(e===undefined||e===null){throw new TypeError("Cannot convert first argument to object")}var n=Object(e);var r=false;var i;for(var a=1;a<arguments.length;a++){var s=arguments[a];if(s===undefined||s===null)continue;var u=Object.keys(Object(s));for(var o=0,l=u.length;o<l;o++){var f=u[o];try{var c=Object.getOwnPropertyDescriptor(s,f);if(c!==undefined&&c.enumerable)n[f]=s[f]}catch(e){if(!r){r=true;i=e}}}if(r)throw i}return n}}},{}],8:[function(e,t,n){var r=e("../Util");t.exports={set:function(e,t,n){var i=r.resolveArgs(arguments,"binding",function(e){return r.canRepresentSubpath(e)?"subpath":null},"?f");return function(t){var n=t.target.value;e.set(i.subpath,i.f?i.f(n):n)}},remove:function(e,t,n){var i=r.resolveArgs(arguments,"binding",function(e){return r.canRepresentSubpath(e)?"subpath":null},"?pred");return function(t){var n=t.target.value;if(!i.pred||i.pred(n)){e.remove(i.subpath)}}},onKey:function(e,t,n,i){var a=n||false;var s=i||false;return function(n){var i=typeof t==="string"?n.key===t:r.find(t,function(e){return e===n.key});if(i&&n.shiftKey===a&&n.ctrlKey===s){e(n)}}},onEnter:function(e){return this.onKey(e,"Enter")},onEscape:function(e){return this.onKey(e,"Escape")}};t.exports["delete"]=t.exports.remove},{"../Util":7}]},{},[1])(1)});